<purpose>Execute a phase prompt (PLAN.md) and create the outcome summary (SUMMARY.md).</purpose><required_reading>Read STATE.md before any operation to load project context.Read config.json for planning behavior settings.@./.claude/get-shit-done/references/git-integration.md</required_reading><process><step name="resolve_model_profile" priority="first">Read model profile for agent spawning:```bashMODEL_PROFILE=$(cat .planning/config.json 2>/dev/null | grep -o '"model_profile"[[:space:]]*:[[:space:]]*"[^"]*"' | grep -o '"[^"]*"$' | tr -d '"' || echo "balanced")```text```bashcat .planning/STATE.md 2>/dev/null```csv```text
```text```bash# Check if planning docs should be committed (default: true)COMMIT_PLANNING_DOCS=$(cat .planning/config.json 2>/dev/null | grep -o '"commit_docs"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "true")# Auto-detect gitignored (overrides config)git check-ignore -q .planning 2>/dev/null && COMMIT_PLANNING_DOCS=false```html```bashcat .planning/ROADMAP.md# Look for phase with "In progress" status# Then find plans in that phasels .planning/phases/XX-name/*-PLAN.md 2>/dev/null | sortls .planning/phases/XX-name/*-SUMMARY.md 2>/dev/null | sort```markdown```bash# Extract phase number (handles XX or XX.Y format)PHASE=$(echo "$PLAN_PATH" | grep -oE '[0-9]+(\.[0-9]+)?-[0-9]+')```html```bashcat .planning/config.json 2>/dev/null```html```text
```html```text
```html```bashPLAN_START_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")PLAN_START_EPOCH=$(date +%s)```html```bash# Find all checkpoints and their typesgrep -n "type=\"checkpoint" .planning/phases/XX-name/{phase}-{plan}-PLAN.md```csv```csv
```text```text
```text```text
```text```text
```text```csv
```text```text
```text```text
```html```bash# Create agent history file if doesn't existif [ ! -f .planning/agent-history.json ]; then  echo '{"version":"1.0","max_entries":50,"entries":[]}' > .planning/agent-history.jsonfi# Clear any stale current-agent-id (from interrupted sessions)# Will be populated when subagent spawnsrm -f .planning/current-agent-id.txt```text```bash# Check if current-agent-id.txt exists from previous interrupted sessionif [ -f .planning/current-agent-id.txt ]; then  INTERRUPTED_ID=$(cat .planning/current-agent-id.txt)  echo "Found interrupted agent: $INTERRUPTED_ID"fi```markdown```bashcat .planning/phases/XX-name/{phase}-{plan}-PLAN.md````This IS the execution instructions. Follow it exactly.**If plan references CONTEXT.md:**The CONTEXT.md file provides the user's vision for this phase — how they imagine it working, what's essential, and what's out of scope. Honor this context throughout execution.</step><step name="previous_phase_check">Before executing, check if previous phase had issues:```bash# Find previous phase summaryls .planning/phases/*/SUMMARY.md 2>/dev/null | sort -r | head -2 | tail -1```markdown```text
```text```markdown## Authentication GatesDuring execution, I encountered authentication requirements:1. Task 3: Vercel CLI required authentication   - Paused for `vercel login`   - Resumed after authentication   - Deployed successfullyThese are normal gates, not errors.```markdown```csv
```text```markdown## Deviations from PlanNone - plan executed exactly as written.```text```markdown## Deviations from Plan### Auto-fixed Issues**1. [Rule 1 - Bug] Fixed case-sensitive email uniqueness constraint**- **Found during:** Task 4 (Follow/unfollow API implementation)- **Issue:** User.email unique constraint was case-sensitive - Test@example.com and test@example.com were both allowed, causing duplicate accounts- **Fix:** Changed to `CREATE UNIQUE INDEX users_email_unique ON users (LOWER(email))`- **Files modified:** src/models/User.ts, migrations/003_fix_email_unique.sql- **Verification:** Unique constraint test passes - duplicate emails properly rejected- **Commit:** abc123f**2. [Rule 2 - Missing Critical] Added JWT expiry validation to auth middleware**- **Found during:** Task 3 (Protected route implementation)- **Issue:** Auth middleware wasn't checking token expiry - expired tokens were being accepted- **Fix:** Added exp claim validation in middleware, reject with 401 if expired- **Files modified:** src/middleware/auth.ts, src/middleware/auth.test.ts- **Verification:** Expired token test passes - properly rejects with 401- **Commit:** def456g---**Total deviations:** 4 auto-fixed (1 bug, 1 missing critical, 1 blocking, 1 architectural with approval)**Impact on plan:** All auto-fixes necessary for correctness/security/performance. No scope creep.```markdown```bashgit status --short```text```bash# Example - adjust to actual files modified by this taskgit add src/api/auth.tsgit add src/types/user.ts```csv```bashgit commit -m "{type}({phase}-{plan}): {concise task description}- {key change 1}- {key change 2}- {key change 3}"```text```bash# Standard plan taskgit commit -m "feat(08-02): create user registration endpoint- POST /auth/register validates email and password- Checks for duplicate users- Returns JWT token on success"# Another standard taskgit commit -m "fix(08-02): correct email validation regex- Fixed regex to accept plus-addressing- Added tests for edge cases"```text```bashTASK_COMMIT=$(git rev-parse --short HEAD)echo "Task ${TASK_NUM} committed: ${TASK_COMMIT}"```text```bashTASK_COMMITS+=("Task ${TASK_NUM}: ${TASK_COMMIT}")```html```text
```text```csv
```text```text
```text```csv
```csv```csv
```text```bashPLAN_END_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")PLAN_END_EPOCH=$(date +%s)DURATION_SEC=$(( PLAN_END_EPOCH - PLAN_START_EPOCH ))DURATION_MIN=$(( DURATION_SEC / 60 ))if [[ $DURATION_MIN -ge 60 ]]; then  HRS=$(( DURATION_MIN / 60 ))  MIN=$(( DURATION_MIN % 60 ))  DURATION="${HRS}h ${MIN}m"else  DURATION="${DURATION_MIN} min"fi```html```bashgrep -A 50 "^user_setup:" .planning/phases/XX-name/{phase}-{plan}-PLAN.md | head -50```sql```markdown# Phase 10: User Setup Required**Generated:** 2025-01-14**Phase:** 10-monetization**Status:** Incomplete## Environment Variables| Status | Variable | Source | Add to ||--------|----------|--------|--------|| [ ] | `STRIPE_SECRET_KEY` | Stripe Dashboard → Developers → API keys → Secret key | `.env.local` || [ ] | `STRIPE_WEBHOOK_SECRET` | Stripe Dashboard → Developers → Webhooks → Signing secret | `.env.local` |## Dashboard Configuration- [ ] **Create webhook endpoint**  - Location: Stripe Dashboard → Developers → Webhooks → Add endpoint  - Details: URL: https://[your-domain]/api/webhooks/stripe, Events: checkout.session.completed## Local DevelopmentFor local testing:\`\`\`bashstripe listen --forward-to localhost:3000/api/webhooks/stripe\`\`\`## Verification[Verification commands based on service]---**Once all items complete:** Mark status as "Complete"```text```markdownPhase: [current] of [total] ([phase name])Plan: [just completed] of [total in phase]Status: [In progress / Phase complete]Last activity: [today] - Completed {phase}-{plan}-PLAN.mdProgress: [progress bar]```markdown```markdown## Current PositionPhase: 2 of 4 (Authentication)Plan: Not startedStatus: Ready to executeLast activity: 2025-01-18 - Phase 1 completeProgress: ██████░░░░ 40%```yaml```markdown## Current PositionPhase: 2 of 4 (Authentication)Plan: 1 of 2 in current phaseStatus: In progressLast activity: 2025-01-19 - Completed 02-01-PLAN.mdProgress: ███████░░░ 50%```markdown```markdownLast session: [current date and time]Stopped at: Completed {phase}-{plan}-PLAN.mdResume file: [path to .continue-here if exists, else "None"]```html```markdown
```html```bashROADMAP_FILE=".planning/ROADMAP.md"```markdown```bashgit add .planning/phases/XX-name/{phase}-{plan}-SUMMARY.mdgit add .planning/STATE.md```text```bashgit add .planning/ROADMAP.md```text```bashgit status# Should show only execution artifacts (SUMMARY, STATE, ROADMAP), no code files```text```bashgit commit -m "$(cat <<'EOF'docs({phase}-{plan}): complete [plan-name] planTasks completed: [N]/[N]- [Task 1 name]- [Task 2 name]- [Task 3 name]SUMMARY: .planning/phases/XX-name/{phase}-{plan}-SUMMARY.mdEOF)"```text```bashgit commit -m "$(cat <<'EOF'docs(08-02): complete user registration planTasks completed: 3/3- User registration endpoint- Password hashing with bcrypt- Email confirmation flowSUMMARY: .planning/phases/08-user-auth/08-02-registration-SUMMARY.mdEOF)"```text```text
```html```bash# Find first task commit (right after previous plan's docs commit)FIRST_TASK=$(git log --oneline --grep="feat({phase}-{plan}):" --grep="fix({phase}-{plan}):" --grep="test({phase}-{plan}):" --reverse | head -1 | cut -d' ' -f1)# Get all changes from first task through nowgit diff --name-only ${FIRST_TASK}^..HEAD 2>/dev/null```text```bashgit add .planning/codebase/*.mdgit commit --amend --no-edit  # Include in metadata commit```html```markdown
```text```bashls -1 .planning/phases/[current-phase-dir]/*-PLAN.md 2>/dev/null | wc -lls -1 .planning/phases/[current-phase-dir]/*-SUMMARY.md 2>/dev/null | wc -l```text```text
```html```bash
```text```bash
```text```bash
```</step></process><success_criteria>- All tasks from PLAN.md completed- All verifications pass- USER-SETUP.md generated if user_setup in frontmatter- SUMMARY.md created with substantive content- STATE.md updated (position, decisions, issues, session)- ROADMAP.md updated- If codebase map exists: map updated with execution changes (or skipped if no significant changes)- If USER-SETUP.md created: prominently surfaced in completion output  </success_criteria>