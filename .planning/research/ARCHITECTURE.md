# Architecture Patterns: Contract Intake System**Domain:** Contract intake and task management for construction services**Researched:** 2026-01-22**Confidence:** HIGH (builds on existing proven patterns in codebase)## Executive SummaryThe contract intake system should follow the existing service-oriented patterns already established in the codebase. The key insight is that Desert Services Hub already has mature implementations of all the building blocks needed: email client, contract parsing, Monday.com integration, and Notion client. The architecture should be a **pipeline coordinator** that orchestrates these existing services rather than reimplementing functionality.## Recommended Architecture```text```csv
```text```text
```text```text
```text```text
```csv```text
```csv```text
```text```bash
```typescript// From services/email/census/classify.tsexport async function classifyEmail(  email: Email,  options: ClassifyOptions = {}): Promise<ClassificationResult> {  const { llmThreshold = 0.6, patternOnly = false } = options;  // First try pattern matching  const patternResult = classifyByPattern(email);  // If pattern confidence is high enough, use it  if (patternResult.confidence >= llmThreshold || patternOnly) {    return patternResult;  }  // Otherwise, try LLM classification  try {    const llmResult = await classifyByLLM(email);    return llmResult;  } catch (error) {    // If LLM fails, fall back to pattern result    return patternResult;  }}```css```typescript// From services/monday/client.tsexport async function findBestMatches(  boardId: string,  name: string,  limit = 5): Promise<ScoredItem[]> {  const items = await getItems(boardId);  return items    .map((item) => ({ ...item, score: calculateSimilarity(name, item.name) }))    .filter((item) => item.score > MIN_SIMILARITY_THRESHOLD)    .sort((a, b) => b.score - a.score)    .slice(0, limit);}```csv```typescript// From services/notion/client.tsexport async function findOrCreateByTitle(options: {  databaseId: string;  titleProperty: string;  titleValue: string;  properties: Record<string, unknown>;}): Promise<FindOrCreateResult> {  // Check for existing  const existingId = await findPageByTitle({    databaseId: options.databaseId,    property: options.titleProperty,    value: options.titleValue,  });  if (existingId) {    return { id: existingId, created: false };  }  // Create new  const newId = await createPage({    databaseId: options.databaseId,    properties: options.properties,  });  return { id: newId, created: true };}```csv```typescript// From services/email/mcp-server.tsfunction getAppClient(): GraphEmailClient {  if (appClient) return appClient;  appClient = new GraphEmailClient(emailConfig);  appClient.initAppAuth();  // Org-wide read access  return appClient;}async function getUserClient(): Promise<GraphEmailClient> {  if (userClient) return userClient;  userClient = new GraphEmailClient(emailConfig);  await userClient.initUserAuth();  // Writes attributed to user  return userClient;}```csv```typescript
```## Scalability Considerations| Concern | Current Scale | 10x Scale | Mitigation ||---------|---------------|-----------|------------|| Email polling | 5-10 contracts/day | 50-100/day | Webhook subscription instead of polling || Monday API calls | Low volume | Rate limited | Batch lookups, cache estimate data || Notion API calls | Low volume | 350ms rate limit | Queue with backoff || PDF parsing | Gemini API calls | Cost grows | Cache parsed results, skip reprocessing || Processing state | SQLite sufficient | SQLite sufficient | SQLite handles millions of rows |## Key Integration Points### Existing Services to Leverage1. **services/email/client.ts** - All email operations already implemented2. **services/contract/client.ts** - PDF extraction with Jina + Gemini3. **services/contract/reconcile.ts** - Line item comparison logic4. **services/monday/client.ts** - All Monday.com operations5. **services/notion/client.ts** - All Notion operations with dedupe helpers6. **services/email/census/classify.ts** - Classification patterns (adapt for contracts)### Data Stores1. **Monday.com ESTIMATING board** - Source of estimates, update with contract status2. **Monday.com CONTACTS board** - Contractor contact info3. **Notion Tasks database** - Destination for intake tasks4. **SQLite (local)** - Processing state, email tracking, cache### External APIs1. **Microsoft Graph** - Email access2. **Monday.com API** - CRM data3. **Notion API** - Task management4. **Jina AI** - PDF text extraction5. **Gemini** - Classification fallback, contract parsing## Sources- Codebase analysis: `services/email/client.ts` - Comprehensive email operations- Codebase analysis: `services/contract/client.ts` - Contract PDF extraction patterns- Codebase analysis: `services/email/census/classify.ts` - Classification with LLM fallback- Codebase analysis: `services/notion/client.ts` - Dedupe helpers- Codebase analysis: `services/monday/client.ts` - Fuzzy matching for lookups- Codebase analysis: `services/inbox/deep-search.ts` - Iterative search pattern