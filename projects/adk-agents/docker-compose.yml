# Docker Compose for ADK agents development
# Hot reload enabled - edit src/ and changes apply immediately

services:
  adk-agents:
    build:
      context: .
      target: dev  # Use dev stage with hot reload
    ports:
      - "8000:8000"
    volumes:
      # Mount source code for hot reload - changes apply without rebuild
      - ./src:/app/src:ro
      # Mount workbench for MCP server access
      - ../../:/app/workbench:ro
      # Mount .env file
      - ./.env:/app/.env:ro
    environment:
      # Google AI
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      # Azure (for email MCP)
      - AZURE_TENANT_ID=${AZURE_TENANT_ID}
      - AZURE_CLIENT_ID=${AZURE_CLIENT_ID}
      - AZURE_CLIENT_SECRET=${AZURE_CLIENT_SECRET}
      # Monday (for Monday MCP)
      - MONDAY_API_KEY=${MONDAY_API_KEY}
      # Notion
      - NOTION_API_KEY=${NOTION_API_KEY}
      # Agent settings
      - DEFAULT_MODEL=gemini-2.5-flash
      - ORCHESTRATOR_MODEL=gemini-2.5-pro
      - DEBUG=true
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3

  # Optional: ADK Web UI for debugging
  adk-web:
    build:
      context: .
      target: dev
    ports:
      - "8080:8080"
    volumes:
      - ./src:/app/src:ro
      - ../../:/app/workbench:ro
      - ./.env:/app/.env:ro
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
    command: ["uv", "run", "adk", "web", "--port", "8080"]
    profiles:
      - debug  # Only start with: docker compose --profile debug up
